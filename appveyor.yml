version: "1.0.0.{build}"
environment:
  COVERALLS_REPO_TOKEN:
    secure: bIg0bHabZSbRpu6KG/YPae8nrv1Gd1gOYRyJrFJiQGAcNK2YUFNBgeYltICJs77M
branches:
  only:
  - master
  - release
image: Visual Studio 2017
configuration: Debug
platform: Any CPU
assembly_info:
  patch: true
  file: '**\AssemblyInfo.*'
  assembly_version: '{version}'
  assembly_file_version: '{version}'
cache:
  - packages -> **\packages.config  # preserve "packages" directory in the root of build folder but will reset it if packages.config is modified
  - '%LocalAppData%\NuGet\Cache'    # NuGet < v3
  - '%LocalAppData%\NuGet\v3-cache' # NuGet v3
before_build:
  - nuget restore
build:
  project: UKSF-Launcher.sln
  verbosity: minimal
test_script:
- cmd: >-
    cd C:\projects\launcher

    packages\OpenCover.4.6.519\tools\OpenCover.Console.exe -register:user -returntargetcode -filter:"+[Launcher*]* -[Launcher.Tests]* -[Launcher]UKSF_Launcher.UI.* -[Launcher]UKSF_Launcher.Global -[Launcher]UKSF_Launcher.Core -[Launcher]UKSF_Launcher.Properties.*" -excludebyattribute:*.ExcludeFromCoverageAttribute "-target:tests.bat" -output:coverage.xml

    packages\coveralls.net.0.7.0\tools\csmacnz.Coveralls.exe --opencover -i coverage.xml
artifacts:
  - path: release\UKSF-Launcher.exe
    name: UKSF-Launcher
  - path: release\Updater.exe
    name: Updater
  - path: release\VersionUpdater.exe
    name: VersionUpdater
  - path: release\Patching.dll
    name: Patching
  - path: release\Network.dll
    name: Network
  - path: release\ServerService.exe
    name: ServerService
deploy:
- provider: FTP
  host: ftp.uk-sf.com
  protocol: ftp
  username: main
  password:
    secure: 1k1dPMXwKdh+kVVv5GxYyA==
  folder: /wamp/www/uksfnew/public/launcher
  artifact: UKSF-Launcher,Updater,VersionUpdater,Patching,Network,ServerService
  on:
    branch: release
after_deploy:
- cmd: '%APPVEYOR_BUILD_FOLDER%\release\PostDeployment.exe'
